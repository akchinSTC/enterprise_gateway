sudo: required
language: python

python:
    - 3.6

services:
    - docker

cache:
    directories:
     - /home/travis/.sbt/

env:
  global:
    - ASYNC_TEST_TIMEOUT=30
    - PATH=$PATH:/snap/bin

before_install:
    - mkdir -p $HOME/.sbt/launchers/1.2.1
    - curl -L -o $HOME/.sbt/launchers/1.2.1/sbt-launch.jar http://central.maven.org/maven2/org/scala-sbt/sbt-launch/1.2.1/sbt-launch-1.2.1.jar
    - sudo apt update

install:
    - pip install --upgrade setuptools pip websocket-client
    - make dist enterprise-gateway-demo
    - pip install dist/*.whl coverage
    - pip freeze
    - curl -LO "https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl"
    - mkdir -p .bin; mv ./kubectl .bin/kubectl && chmod +x .bin/kubectl
    - export PATH="$TRAVIS_BUILD_DIR/.bin:$PATH"
    - wget https://cdn.rawgit.com/Mirantis/kubeadm-dind-cluster/master/fixed/dind-cluster-v1.7.sh && chmod +x dind-cluster-v1.7.sh && ./dind-cluster-v1.7.sh up
    - export PATH="$HOME/.kubeadm-dind-cluster:$PATH"

script:
    - jupyter enterprisegateway --help

after_success:
  - echo "Travis exited with ${TRAVIS_TEST_RESULT}"
  - python --version
  - pip --version
  - pip list
  - pip install codecov
  - codecov

after_failure:
  - echo "Travis exited with ${TRAVIS_TEST_RESULT}"
  - python --version
  - pip --version
  - pip list
  - docker logs itest-yarn
